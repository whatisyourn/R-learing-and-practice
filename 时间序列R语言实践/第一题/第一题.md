# 一、 数据来源

使用R语言对其股票收盘价格进行均值方差的GARCH建模，并进行相关图片的绘制和平稳性检验，并且检测模型拟合效果。

首先，数据从同花顺证券交易平台中获取，我选择了选取的股票为昆仑万维（300418.SZ），选取的时间跨度为2015/8/6至2022/4/14，共计1620条每日收盘价数据作为建模数据，并且选取其收盘价作为建模变量。对于该时间序列数据，我们使用ggplot()函数进行折线图的绘制，如图1所示.发现该时间序列不是平稳的。

![close](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/close.png)

​                                                                       图1：收盘价格的价格图

# 二、数据平稳

由于我们的ARIMA建模需要数据保持平稳，为了将非平稳序列转换为平稳序列，因此我们进行差分化，从原始序列中减去该序列滞后1期，以下是差分之后的数据所绘制的时序图，如图二所示。该系列似乎更具有均值回复性，并且方差是恒定的，并且不会随着原始系列级别的变化而显着变化。

![data_r](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/data_r.png)

​																		图2：差分收盘价格

# 三、均值模型

自相关和偏自相关是ARIMA模型的核心。然后画出其自相关和偏自相关曲线。从自相关和偏自相关曲线上看，ACF与PACF都有截尾形式，如图3所示，从自相关和偏自相关曲线上看，ARIMA(1,0,1)有比较好的效果。使用AIC作为信息准则对ARIMA的阶数进行更精确的确定。ARIMA(3,0,1) ，均值0是AIC作为信息准则下最好的模型。我们使用ARIMA(3,0,1)进行估计。模型的估计结果显示在表1中。检验结果发现部分参数不显著，将不显著的参数强制为0。可以看到模型稀疏十分显著。我们可以得到拟合稀疏模型ARIMA(2,0,1)。
$$
\Delta Y_t =-0.8367\Delta Y_{t-1}+0.01978\Delta Y_{t-2}+0.8747\epsilon_{t-1}+\epsilon_{t}
$$
![rADF](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/rADF.png)

​                                                                 图3：差分数据的ACF与PACF

​                                                                    表1：ARIMA(2,0,2)回归结果

```
Coefficients:
         ar1     ar2     ar3      ma1
      0.5407  0.0532  0.0343  -0.6135
s.e.  0.3184  0.0356  0.0287   0.3183
p     0.0894**  0.1348*  0.2321   0.0539**
sigma^2 = 0.7885:  log likelihood = -2102.92
AIC=4215.85   AICc=4215.88   BIC=4242.79

*：15%下显著 **:10%下显著 ***5%水平下显著
```

​                                                                     表2：ARIMA(2,0,2)稀疏模型回归结果

```
          ar1   |    ar2      |   ma1     |
      -0.836753   0.019783      0.874727
p  | 1.74e-05***| 0.0010828***| 2.4e-06***|
*：15%下显著 **:10%下显著 ***5%水平下显著
```

# 四、模型诊断

残差图ACF和PACF没有任何明显的滞后，表明ARIMA（2,0,1）是表示该序列的良好模型。

此外，进行Ljung-Box测试来仔细检查模型。Ljung-Box回归结果入表2所示，滞后阶数为6、12、24、36的p值均明显小于0.05，意味着数据是独立且不相关的；并且说明该数据不是白噪声数据，数据有价值，可以继续分析。

![residual](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/residual.png)

​                                                                 图4：残差数据折线图

![resdualADF](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/resdualADF.png)

​                                                                    图5：残差序列数据的ACF与PACF

​                                                                    表3 Ljung-Box检验结果

```
Modified Box-Pierce (Ljung-Box) Chi-Square statistic
Lag      6            12    24        36 
P-Value 0.04725   0.002635 8.957e-05 1.047e-07
```

# 五、方差分析

尽管残差的ACF和PACF没有明显的滞后，但是残差的时间序列图显示出一些波动性。ARIMA为序列提供了最佳的线性预测，因此在非线性模型预测中几乎没有作用。为了建模波动，需要用到ARCH / GARCH方法。

为了检验是否存在是否需要ARCH / GARCH。首先，检查残差图是否显示任何波动性。接下来，观察残差平方。如果存在波动性，则应使用ARCH / GARCH对系列的波动性建模，以反映该系列中更多的近期变化和波动。最后，平方残差的ACF和PACF将有助于确认残差（噪声项）是否独立且可以预测。如前所述，严格的白噪声不能线性或非线性地预测，而普通的白噪声可能不能线性地预测但仍不能非线性地预测。如果残差是严格的白噪声，则它们与零均值，正态分布无关，并且平方残差的ACF和PACF没有明显的滞后。

以下是平方残差的图：

•残差平方图显示了某些时间点的波动性

 •滞后5时，PACF仍会截断，即使有些滞后仍然很大

![redualssqr](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/redualssqr.png)

​                                                                                图6 残差平方序列图

​                         ![resudualACF](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/resudualACF.png)                                



​                                                               图7：残差序列平方的ACF与PACF

为了进一步确认存在ARCH效应，使用LM检验，检验p值2.2e-16远小于0.05。因此，LM检验都是显著的，即模型的残差序列存在arch效应。残差显示了一些可以建模的模式。ARCH / GARCH对模型波动率建模很有必要。

# 六、方差建模

首先使用GARCH(1,1)进行建模。使用拟合的方差模型为sGARCH,方差模型的自回归阶数是(1，1)，方差模型中未引入外生变量。均值方程为arima(2,1)模型，方程自变量中包含均值，未引入外生变量。模型分布假设为正态分布。观察下表可以看到GARCH(1,1)的拟合效果很好，系数均显著。建立如下方差模型。
$$
\sigma^2_{t+1} = 0.008132 + 0.068806\epsilon^2_{t}+ 0.915132\sigma^2_{t}
$$
​                                                               表4 GARCH(1,1)回归结果

```
        Estimate  Std. Error  t value Pr(>|t|)
ar1    -0.836753    0.126578 -6.61057 0.000000***
ar2     0.019783    0.028719  0.68884 0.490923
ma1     0.874727    0.123651  7.07415 0.000000***
omega   0.008132    0.002214  3.67394 0.000239***
alpha1  0.068806    0.010810  6.36479 0.000000***
beta1   0.915132    0.012562 72.84657 0.000000***
*：10%下显著 **:5%下显著 ***1%水平下显著
```



# 七、方差模型的评估

在建模完成后，我们开始绘制图像，以验证模型的效果。我们画出对数价格差分序列和GARCH模型条件方差，如下图8所示可以看到，在大部分情况下，模型的条件方差的波动是非常类似实际数据的。这说明我们建立的GARCH模型的效果是非常好的。![codSD](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/codSD.png)

​                                                                图8 模型的条件均值和条件方差

最后，我们检验一下模型的拟合效果，使用残差分析法来进行。在残差分析中，我们进行残差QQ图和残差自相关的检验。从QQ图上看，残差分布基本符合正态分布。从自相关曲线上看，残差在大部分滞后阶上都满足白噪声的特征。可以认为模型拟合良好

![error](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/error.png)

​                                                                                 图9 残差的ACF

![QQ](%E7%AC%AC%E4%B8%80%E9%A2%98.assets/QQ.png)

​                                                                             图10 残差的QQ图

# 八、总结

以上代码和注释演示了如何对中国股市的300418.SZ股票价格进行ARIMA均值建模和方差的GARCH建模，包括对阶数的判断、相关图片的绘制和平稳性检验，并检测模型的拟合效果。具体步骤包括获取股票价格数据，转换为日收益率，绘制时间序列图观察趋势性，进行平稳性检验，构建ARIMA模型，评估模型残差序列进行判断，构建GARCH模型，预测未来方差，绘制实际价格数据与ARIMA和GARCH模型预测结果的比较图表。
